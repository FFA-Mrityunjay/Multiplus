name: Deploy Static Site to EC2 (No SSH)

on:
  push:
    branches: ["main"]
  pull_request:
    branches: ["main"]

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout Code
      uses: actions/checkout@v4

    - name: Install Node (optional if no build step)
      uses: actions/setup-node@v4
      with:
        node-version: 18

    - name: Build Project (Optional)
      run: |
        echo "No build needed for pure HTML/JS"
        # Add build commands here if required

    - name: Run Tests (Optional)
      run: |
        echo "Add JS tests here if needed"

    - name: Zip Artifact
      run: |
        zip -r site.zip index.html Sample_Table.html *.js


      env:
        AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}
        AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
        AWS_REGION: "ap-south-1"

    - name: Deploy to EC2 using SSM (NO SSH)
      run: |
        aws ssm send-command \
          --instance-ids "${{ secrets.EC2_INSTANCE_ID }}" \
          --document-name "AWS-RunShellScript" \
          --comment "Deploy HTML/JS site" \
          --parameters commands="sudo aws s3 cp s3://${{ secrets.S3_BUCKET }}/site.zip /tmp/site.zip; sudo unzip -o /tmp/site.zip -d /var/www/html/" \
          --output text

      env:
        AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}
        AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
        AWS_REGION: "ap-south-1"
